<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mobile Survivor - ‡∏û‡∏≤‡∏£‡∏ß‡∏µ‡∏£‡πå</title>
    <style>
        :root { --bg: #000; --txt: #fff; --accent: #0f0; }
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; outline: none; }
        body, html { background: var(--bg); height: 100%; width: 100%; overflow: hidden; position: fixed; font-family: sans-serif; }
        
        .half { height: 50%; display: flex; flex-direction: column; position: relative; border-bottom: 1px solid #222; transition: 0.4s; background: var(--bg); }
        .top { transform: rotate(180deg); }
        .half.waiting { opacity: 0.4; filter: grayscale(1); }

        .controls { position: absolute; top: 12px; width: 100%; display: flex; justify-content: space-between; padding: 0 15px; z-index: 100; }
        select { background: #222; color: #fff; border: 1px solid #444; font-size: 12px; border-radius: 4px; padding: 4px; }
        .mute-btn { background: #222; border: 1px solid #444; color: #666; border-radius: 4px; padding: 4px 10px; cursor: pointer; }
        .mute-btn.on { color: #f44; border-color: #f44; }

        .stage { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; padding: 15px; }
        .mic-btn { width: 100px; height: 100px; background: #111; border: 3px solid #333; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #888; cursor: pointer; }
        .mic-btn.listening { border-color: var(--accent); color: var(--accent); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0,255,0,0.4); } 70% { box-shadow: 0 0 0 20px rgba(0,255,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,255,0,0); } }

        .display-box { font-size: 8.5vw; font-weight: 900; line-height: 1.2; text-align: center; width: 100%; display: none; padding: 20px; color: var(--txt); word-break: break-word; }
        .has-msg .mic-btn { display: none; }
        .has-msg .display-box { display: block; }

        .buffer-row { height: 70px; background: #080808; border-top: 1px solid #222; display: flex; align-items: center; gap: 10px; padding: 0 15px; }
        .buffer-box { flex: 1; background: #000; border: 1px solid #333; border-radius: 10px; padding: 12px; font-size: 16px; color: var(--accent); outline: none; overflow-x: auto; white-space: nowrap; }
        .send-btn { width: 45px; height: 45px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #000; border: none; font-weight: bold; }

        .theme-trigger { position: absolute; bottom: 80px; left: 15px; width: 15px; height: 15px; background: #111; border-radius: 50%; z-index: 10; opacity: 0.2; }
    </style>
</head>
<body onload="init()">

    <div class="half top" id="top-half">
        <div class="controls">
            <select id="top-lang"></select>
            <div class="mute-btn" id="top-mute" onclick="toggleMute('top')">üîä</div>
        </div>
        <div class="stage" onclick="clearMsg('top')">
            <div class="mic-btn" id="top-mic" onclick="startVoice('top')">üéôÔ∏è</div>
            <div class="display-box" id="top-display" onclick="replay('top')"></div>
        </div>
        <div class="buffer-row">
            <div class="buffer-box" id="top-buffer" contenteditable="true"></div>
            <button class="send-btn" onclick="send('top')">‚ûî</button>
        </div>
    </div>

    <div class="half bottom" id="bottom-half">
        <div class="controls">
            <select id="bottom-lang"></select>
            <div class="mute-btn" id="bottom-mute" onclick="toggleMute('bottom')">üîä</div>
        </div>
        <div class="stage" onclick="clearMsg('bottom')">
            <div class="mic-btn" id="bottom-mic" onclick="startVoice('bottom')">üéôÔ∏è</div>
            <div class="display-box" id="bottom-display" onclick="replay('bottom')"></div>
        </div>
        <div class="theme-trigger" onclick="cycleTheme()"></div>
        <div class="buffer-row">
            <div class="buffer-box" id="bottom-buffer" contenteditable="true"></div>
            <button class="send-btn" onclick="send('bottom')">‚ûî</button>
        </div>
    </div>

    <script>
        const langs = {"th-TH":"üáπüá≠ TH","en-US":"üá∫üá∏ EN","no-NO":"üá≥üá¥ NO","sv-SE":"üá∏üá™ SE","de-DE":"üá©üá™ DE","ja-JP":"üáØüáµ JP","fr-FR":"üá´üá∑ FR","zh-CN":"üá®üá≥ ZH"};
        let themes = [{bg:'#000',txt:'#fff',acc:'#0f0'}, {bg:'#f4ecd8',txt:'#432',acc:'#8b4'}];
        let currentTheme = 0;
        let muteState = {top:false, bottom:false};
        let lastResult = {top: "", bottom: ""};

        // ‡∏õ‡∏•‡∏∏‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏∑‡πà‡∏ô‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ [cite: 2026-01-17]
        const synth = window.speechSynthesis;
        function unlockAudio() {
            const u = new SpeechSynthesisUtterance("");
            synth.speak(u);
        }

        let recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.continuous = false;
        recognition.interimResults = true;

        function init() {
            ['top', 'bottom'].forEach(s => {
                const sel = document.getElementById(s + '-lang');
                Object.keys(langs).forEach(k => sel.add(new Option(langs[k], k)));
                sel.value = (s === 'top') ? 'en-US' : 'th-TH';
            });
            document.body.addEventListener('touchstart', unlockAudio, {once: true});
        }

        let activeSide = null;
        function startVoice(side) {
            unlockAudio(); // ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏¥‡πâ‡∏° [cite: 2025-12-31]
            activeSide = side;
            document.getElementById(side + '-mic').classList.add('listening');
            recognition.lang = document.getElementById(side + '-lang').value;
            try { recognition.start(); } catch(e) {}
        }

        recognition.onresult = (e) => {
            let t = ""; for (let i = e.resultIndex; i < e.results.length; ++i) t += e.results[i][0].transcript;
            if (activeSide) document.getElementById(activeSide + '-buffer').innerText = t;
        };

        recognition.onend = () => {
            if (activeSide) document.getElementById(activeSide + '-mic').classList.remove('listening');
            activeSide = null;
        };

        async function send(side) {
            const text = document.getElementById(side + '-buffer').innerText.trim();
            if (!text) return;
            const other = (side === 'top') ? 'bottom' : 'top';
            const target = document.getElementById(other + '-lang').value;
            
            try {
                const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${target.split('-')[0]}&dt=t&q=${encodeURI(text)}`);
                const data = await res.json();
                const result = data[0][0][0];
                
                lastResult[other] = result;
                const box = document.getElementById(other + '-display');
                box.innerText = result;
                document.getElementById(other + '-half').classList.add('has-msg');
                document.getElementById(side + '-buffer').innerText = "";
                
                if (!muteState[other]) {
                    const u = new SpeechSynthesisUtterance(result);
                    u.lang = target; u.rate = 0.9; synth.speak(u);
                }
            } catch (e) {}
        }

        function replay(side) {
            if (lastResult[side]) {
                const u = new SpeechSynthesisUtterance(lastResult[side]);
                u.lang = document.getElementById(side + '-lang').value;
                synth.speak(u);
            }
        }

        function toggleMute(s) { muteState[s] = !muteState[s]; document.getElementById(s+'-mute').classList.toggle('on'); }
        function clearMsg(s) { document.getElementById(s + '-half').classList.remove('has-msg'); synth.cancel(); }
        function cycleTheme() {
            currentTheme = (currentTheme + 1) % themes.length;
            const t = themes[currentTheme];
            document.documentElement.style.setProperty('--bg', t.bg);
            document.documentElement.style.setProperty('--txt', t.txt);
            document.documentElement.style.setProperty('--accent', t.acc);
        }
    </script>
</body>
</html>
